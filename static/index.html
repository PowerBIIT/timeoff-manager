<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeOff Manager</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Google Fonts - Poppins & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }

        /* Modern color palette */
        :root {
            --primary: #0F172A;
            --accent: #10B981;
            --bg-light: #F8FAFC;
            --text-dark: #1E293B;
            --text-muted: #64748B;
        }

        .gradient-emerald {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .gradient-slate {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Loading spinner */
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #10B981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast animations */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Smooth transitions */
        * {
            transition: all 0.2s ease;
        }

        /* Mobile bottom nav */
        .mobile-nav {
            display: none;
        }

        @media (max-width: 768px) {
            .desktop-sidebar {
                /* Nie używamy display: none - używamy transform zamiast tego */
            }

            .mobile-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 50;
                background: white;
                border-top: 1px solid #E2E8F0;
                padding: 8px 0;
                box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            }

            .mobile-nav-item {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px;
                font-size: 11px;
                color: #64748B;
                text-decoration: none;
                gap: 4px;
            }

            .mobile-nav-item.active {
                color: #10B981;
            }

            .mobile-nav-icon {
                font-size: 20px;
            }

            .content-wrapper {
                padding-bottom: 80px;
            }
        }

        /* Card hover effect */
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* Status pulse animation */
        @keyframes pulse-glow {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }

        .status-pulse {
            animation: pulse-glow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F1F5F9;
        }

        ::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 40;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
        }

        @media (min-width: 768px) {
            .fab {
                display: none;
            }
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 25px -5px rgba(16, 185, 129, 0.4);
        }

        /* Improved mobile modal */
        @media (max-width: 768px) {
            .modal-content {
                border-radius: 24px 24px 0 0;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0F172A',
                        accent: '#10B981',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Poppins', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // ============================================
        // AXIOS SETUP
        // ============================================
        axios.defaults.baseURL = window.location.origin;

        // Add token to requests if available
        const token = localStorage.getItem('token');
        if (token) {
            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
        }

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================
        const Toast = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-emerald-500',
                error: 'bg-red-500',
                warning: 'bg-amber-500',
                info: 'bg-blue-500'
            };

            return (
                <div className={`toast ${colors[type]} text-white px-6 py-4 rounded-2xl shadow-2xl max-w-md`}>
                    <div className="flex items-center gap-3">
                        <span className="font-medium">{message}</span>
                        <button onClick={onClose} className="ml-4 text-white hover:text-gray-200 text-xl">
                            ✕
                        </button>
                    </div>
                </div>
            );
        };

        // ============================================
        // LOADING SPINNER
        // ============================================
        const LoadingSpinner = () => (
            <div className="flex justify-center items-center py-12">
                <div className="loading-spinner"></div>
            </div>
        );

        // ============================================
        // ICONS (SVG Duotone Components) - Premium Design
        // ============================================
        const Icons = {
            Dashboard: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <path opacity="0.3" d="M3 13h8v8H3z" fill="currentColor"/>
                    <path d="M3 3h8v8H3z" fill="currentColor"/>
                    <path opacity="0.3" d="M13 3h8v8h-8z" fill="currentColor"/>
                    <path d="M13 13h8v8h-8z" fill="currentColor"/>
                </svg>
            ),
            Plus: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" opacity="0.3" fill="currentColor"/>
                    <path d="M12 8v8m-4-4h8" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
                </svg>
            ),
            Calendar: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="6" width="18" height="15" rx="2" opacity="0.3" fill="currentColor"/>
                    <path d="M3 10h18M8 3v4m8-4v4" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                    <circle cx="8" cy="14" r="1.5" fill="currentColor"/>
                    <circle cx="12" cy="14" r="1.5" fill="currentColor"/>
                    <circle cx="16" cy="14" r="1.5" fill="currentColor"/>
                    <circle cx="8" cy="18" r="1.5" fill="currentColor"/>
                </svg>
            ),
            Clock: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="9" opacity="0.3" fill="currentColor"/>
                    <path d="M12 7v5l3.5 3.5" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"/>
                    <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                </svg>
            ),
            Users: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <circle cx="9" cy="7" r="4" opacity="0.3" fill="currentColor"/>
                    <path d="M3 21c0-3.5 2.7-6 6-6s6 2.5 6 6" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                    <circle cx="17" cy="7" r="3" fill="currentColor"/>
                    <path d="M21 21c0-2.5-1.8-4.5-4-4.5" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                </svg>
            ),
            Settings: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    <path opacity="0.3" d="M12 1l2.5 4.5h5L21 10l-1.5 4.5-4.5 1.5L12 21l-2.5-4.5h-5L3 12l1.5-4.5 4.5-1.5L12 1z" fill="currentColor"/>
                </svg>
            ),
            List: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="4" width="18" height="16" rx="2" opacity="0.3" fill="currentColor"/>
                    <path d="M7 8h10M7 12h10M7 16h7" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"/>
                </svg>
            ),
            Menu: () => (
                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="5" width="18" height="2" rx="1" fill="currentColor"/>
                    <rect x="3" y="11" width="18" height="2" rx="1" opacity="0.5" fill="currentColor"/>
                    <rect x="3" y="17" width="18" height="2" rx="1" fill="currentColor"/>
                </svg>
            ),
            // KPI Card Icons
            ChartBar: ({ className }) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="14" width="4" height="7" rx="1" opacity="0.3" fill="currentColor"/>
                    <rect x="10" y="8" width="4" height="13" rx="1" fill="currentColor"/>
                    <rect x="17" y="3" width="4" height="18" rx="1" opacity="0.6" fill="currentColor"/>
                </svg>
            ),
            Hourglass: ({ className }) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <path opacity="0.3" d="M8 2h8l-3 7 3 7H8l3-7-3-7z" fill="currentColor"/>
                    <circle cx="12" cy="9" r="1.5" fill="currentColor"/>
                    <path d="M8 2h8M8 21h8" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                </svg>
            ),
            CheckCircle: ({ className }) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" opacity="0.3" fill="currentColor"/>
                    <path d="M8 12.5l2.5 2.5 5.5-5.5" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
            ),
            XCircle: ({ className }) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" opacity="0.3" fill="currentColor"/>
                    <path d="M9 9l6 6m0-6l-6 6" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"/>
                </svg>
            ),
            Wave: ({ className }) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <path opacity="0.3" d="M4 12c0-1.5 1-3 2.5-3s2.5 1.5 4 3c1.5 1.5 2.5 3 4 3s2.5-1.5 2.5-3" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                    <path d="M7 8c1 1 2 2 3 2s2-1 3-2" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
                </svg>
            ),
        };

        // ============================================
        // LOGIN VIEW
        // ============================================
        const LoginView = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    const res = await axios.post('/api/login', { email, password });
                    localStorage.setItem('token', res.data.token);
                    axios.defaults.headers.common['Authorization'] = `Bearer ${res.data.token}`;
                    onLogin(res.data.user);
                } catch (err) {
                    setError(err.response?.data?.error || 'Błąd logowania');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center gradient-slate p-4">
                    <div className="glass rounded-3xl shadow-2xl p-8 w-full max-w-md border border-white/20">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 mx-auto mb-4 bg-emerald-500 rounded-2xl flex items-center justify-center shadow-lg">
                                <Icons.Calendar />
                            </div>
                            <h1 className="text-4xl font-bold mb-2 text-white">
                                TimeOff
                            </h1>
                            <p className="text-slate-300">System zarządzania wnioskami</p>
                        </div>

                        {error && (
                            <div className="bg-red-500/10 border border-red-500/20 backdrop-blur p-4 mb-6 rounded-xl">
                                <p className="text-red-200 text-sm">{error}</p>
                            </div>
                        )}

                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-slate-200 font-medium mb-2 text-sm">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 bg-white/95 border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-400 text-slate-900 placeholder-slate-500"
                                    placeholder="email@firma.pl"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-slate-200 font-medium mb-2 text-sm">Hasło</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 bg-white/95 border border-white/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-400 text-slate-900 placeholder-slate-500"
                                    placeholder="••••••••"
                                    required
                                />
                            </div>

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full px-6 py-3 gradient-emerald text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-emerald-500/50 transition disabled:opacity-50 flex items-center justify-center gap-2 mt-6"
                            >
                                {loading ? (
                                    <>
                                        <div className="loading-spinner border-white"></div>
                                        <span>Logowanie...</span>
                                    </>
                                ) : 'Zaloguj się'}
                            </button>
                        </form>

                        <div className="mt-6 p-4 bg-white/5 backdrop-blur rounded-xl border border-white/10">
                            <p className="text-xs text-slate-300 mb-2 font-semibold">Konta testowe:</p>
                            <p className="text-xs text-slate-400">Admin: admin@firma.pl / admin123</p>
                            <p className="text-xs text-slate-400">Manager: manager@firma.pl / manager123</p>
                            <p className="text-xs text-slate-400">Pracownik: jan@firma.pl / jan123</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================
        // MOBILE HEADER
        // ============================================
        const MobileHeader = ({ user, onMenuClick, onLogout }) => {
            const roleLabels = {
                'pracownik': 'Pracownik',
                'manager': 'Manager',
                'admin': 'Admin'
            };

            return (
                <div className="md:hidden gradient-slate text-white px-4 py-4 shadow-lg sticky top-0 z-40">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <button onClick={onMenuClick} className="p-2 hover:bg-white/10 rounded-lg">
                                <Icons.Menu />
                            </button>
                            <div>
                                <h1 className="text-xl font-bold">TimeOff</h1>
                                <p className="text-xs text-slate-300">{user.first_name} {user.last_name}</p>
                            </div>
                        </div>
                        <button
                            onClick={onLogout}
                            className="text-sm px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg"
                        >
                            Wyloguj
                        </button>
                    </div>
                </div>
            );
        };

        // ============================================
        // SIDEBAR (Desktop)
        // ============================================
        const Sidebar = ({ activeView, setView, role, user, onLogout, mobileOpen, setMobileOpen }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: Icons.Dashboard, roles: ['pracownik', 'manager', 'admin'] },
                { id: 'new-request', label: 'Nowy wniosek', icon: Icons.Plus, roles: ['pracownik', 'manager', 'admin'] },
                { id: 'my-requests', label: 'Moje wnioski', icon: Icons.Calendar, roles: ['pracownik', 'manager', 'admin'] },
                { id: 'pending', label: 'Oczekujące', icon: Icons.Clock, roles: ['manager', 'admin'] },
                { id: 'users', label: 'Użytkownicy', icon: Icons.Users, roles: ['admin'] },
                { id: 'settings', label: 'Ustawienia', icon: Icons.Settings, roles: ['admin'] },
                { id: 'audit', label: 'Audit Log', icon: Icons.List, roles: ['admin'] },
            ];

            const roleLabels = {
                'pracownik': 'Pracownik',
                'manager': 'Manager',
                'admin': 'Administrator'
            };

            const handleNavClick = (itemId) => {
                setView(itemId);
                setMobileOpen(false);
            };

            return (
                <>
                    {/* Mobile overlay */}
                    {mobileOpen && (
                        <div
                            className="fixed inset-0 bg-black/50 z-40 md:hidden"
                            onClick={() => setMobileOpen(false)}
                        ></div>
                    )}

                    {/* Sidebar */}
                    <div className={`
                        desktop-sidebar
                        fixed md:sticky top-0 h-screen
                        w-72 bg-white shadow-xl
                        transform transition-transform duration-300 z-50
                        ${mobileOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}
                    `}>
                        <div className="p-6 border-b border-gray-100">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-12 h-12 bg-emerald-500 rounded-xl flex items-center justify-center shadow-lg">
                                    <Icons.Calendar />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800">TimeOff</h1>
                                    <p className="text-xs text-gray-500">Manager</p>
                                </div>
                            </div>
                            <div className="bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl p-3 border border-emerald-200">
                                <p className="font-semibold text-sm text-gray-800">{user.first_name} {user.last_name}</p>
                                <p className="text-xs text-emerald-700">{roleLabels[user.role]}</p>
                            </div>
                        </div>

                        <nav className="p-4 space-y-1 flex-1 overflow-y-auto">
                            {menuItems.filter(item => item.roles.includes(role)).map(item => {
                                const Icon = item.icon;
                                return (
                                    <button
                                        key={item.id}
                                        onClick={() => handleNavClick(item.id)}
                                        className={`w-full text-left px-4 py-3 rounded-xl transition flex items-center gap-3 ${
                                            activeView === item.id
                                                ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/30'
                                                : 'hover:bg-gray-100 text-gray-700'
                                        }`}
                                    >
                                        <Icon />
                                        <span className="font-medium">{item.label}</span>
                                    </button>
                                );
                            })}
                        </nav>

                        <div className="p-4 border-t border-gray-100 hidden md:block">
                            <button
                                onClick={onLogout}
                                className="w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition font-medium"
                            >
                                Wyloguj się
                            </button>
                        </div>
                    </div>
                </>
            );
        };

        // ============================================
        // FOOTER WITH VERSION
        // ============================================
        const Footer = () => {
            const [version, setVersion] = useState(null);

            useEffect(() => {
                loadVersion();
            }, []);

            const loadVersion = async () => {
                try {
                    const res = await axios.get('/api/version');
                    setVersion(res.data);
                } catch (err) {
                    console.error('Failed to load version:', err);
                }
            };

            if (!version) return null;

            return (
                <div className="fixed bottom-0 left-0 right-0 md:left-72 glass border-t border-gray-200/50 backdrop-blur-xl z-30 md:z-10 hidden md:block">
                    <div className="flex items-center justify-between max-w-7xl mx-auto px-6 py-2.5">
                        <div className="flex items-center gap-3 text-xs">
                            <div className="flex items-center gap-2">
                                <svg className="w-3.5 h-3.5 text-emerald-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                                <span className="font-mono text-slate-700 font-medium">{version.commit}</span>
                            </div>
                            <span className="text-slate-300">•</span>
                            <span className="text-slate-500">{version.date}</span>
                            {version.branch && (
                                <>
                                    <span className="text-slate-300">•</span>
                                    <span className={`px-2 py-0.5 rounded-md text-[10px] font-medium ${
                                        version.branch === 'master'
                                            ? 'bg-emerald-50 text-emerald-700 border border-emerald-200'
                                            : 'bg-blue-50 text-blue-700 border border-blue-200'
                                    }`}>
                                        {version.branch}
                                    </span>
                                </>
                            )}
                        </div>
                        <div className="text-[10px] text-slate-400 font-medium">
                            © 2025 PowerBIIT
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================
        // MOBILE BOTTOM NAV
        // ============================================
        const MobileBottomNav = ({ activeView, setView, role }) => {
            const navItems = [
                { id: 'dashboard', label: 'Home', icon: '🏠', roles: ['pracownik', 'manager', 'admin'] },
                { id: 'my-requests', label: 'Wnioski', icon: '📋', roles: ['pracownik', 'manager', 'admin'] },
                { id: 'pending', label: 'Oczekujące', icon: '⏳', roles: ['manager', 'admin'] },
                { id: 'users', label: 'Użytkownicy', icon: '👥', roles: ['admin'] },
            ].filter(item => item.roles.includes(role));

            return (
                <div className="mobile-nav">
                    {navItems.map(item => (
                        <button
                            key={item.id}
                            onClick={() => setView(item.id)}
                            className={`mobile-nav-item ${activeView === item.id ? 'active' : ''}`}
                        >
                            <span className="mobile-nav-icon">{item.icon}</span>
                            <span className="font-medium">{item.label}</span>
                        </button>
                    ))}
                </div>
            );
        };

        // ============================================
        // DASHBOARD VIEW
        // ============================================
        const DashboardView = ({ user }) => {
            const [stats, setStats] = useState(null);
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedFilter, setSelectedFilter] = useState(null);

            useEffect(() => {
                loadStats();
            }, []);

            const loadStats = async () => {
                try {
                    let endpoint = '/api/requests';
                    if (user.role === 'pracownik') {
                        endpoint += `?employee_id=${user.id}`;
                    } else if (user.role === 'manager') {
                        endpoint += `?supervisor_id=${user.id}`;
                    }

                    const res = await axios.get(endpoint);
                    const allRequests = res.data;
                    setRequests(allRequests);

                    setStats({
                        total: allRequests.length,
                        pending: allRequests.filter(r => r.status === 'oczekujący').length,
                        approved: allRequests.filter(r => r.status === 'zaakceptowany').length,
                        rejected: allRequests.filter(r => r.status === 'odrzucony').length,
                    });
                } catch (err) {
                    console.error('Error loading stats:', err);
                } finally {
                    setLoading(false);
                }
            };

            const handleCardClick = (filter) => {
                setSelectedFilter(selectedFilter === filter ? null : filter);
            };

            const getFilteredRequests = () => {
                if (!selectedFilter) return [];
                if (selectedFilter === 'all') return requests;
                if (selectedFilter === 'pending') return requests.filter(r => r.status === 'oczekujący');
                if (selectedFilter === 'approved') return requests.filter(r => r.status === 'zaakceptowany');
                if (selectedFilter === 'rejected') return requests.filter(r => r.status === 'odrzucony');
                return [];
            };

            if (loading) return <LoadingSpinner />;

            const StatCard = ({ title, value, color, IconComponent, filter }) => (
                <div
                    onClick={() => handleCardClick(filter)}
                    className={`glass rounded-2xl shadow-lg p-6 border border-gray-100 cursor-pointer hover-lift ${
                        selectedFilter === filter ? 'ring-4 ring-' + color + '-300 ring-offset-2' : ''
                    }`}
                >
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-gray-500 text-sm font-medium mb-2">{title}</p>
                            <p className={`text-4xl font-bold text-${color}-600`}>{value}</p>
                        </div>
                        <div className={`w-12 h-12 bg-${color}-100 rounded-xl flex items-center justify-center text-${color}-600`}>
                            <IconComponent className="w-7 h-7" />
                        </div>
                    </div>
                    {selectedFilter === filter && (
                        <div className="mt-3 text-xs text-gray-500 font-medium">
                            ▼ Kliknij ponownie aby ukryć
                        </div>
                    )}
                </div>
            );

            const statusColors = {
                'oczekujący': 'bg-amber-100 text-amber-800 border-amber-200',
                'zaakceptowany': 'bg-emerald-100 text-emerald-800 border-emerald-200',
                'odrzucony': 'bg-red-100 text-red-800 border-red-200',
            };

            const filteredRequests = getFilteredRequests();

            return (
                <div className="p-4 md:p-8 content-wrapper">
                    <div className="mb-8">
                        <h2 className="text-3xl font-bold mb-1 text-gray-800 flex items-center gap-3">
                            Witaj, {user.first_name}!
                            <Icons.Wave className="w-8 h-8 text-emerald-500" />
                        </h2>
                        <p className="text-gray-500">Oto podsumowanie Twoich wniosków</p>
                    </div>

                    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
                        <StatCard title="Wszystkie" value={stats?.total || 0} color="blue" IconComponent={Icons.ChartBar} filter="all" />
                        <StatCard title="Oczekujące" value={stats?.pending || 0} color="amber" IconComponent={Icons.Hourglass} filter="pending" />
                        <StatCard title="Zaakceptowane" value={stats?.approved || 0} color="emerald" IconComponent={Icons.CheckCircle} filter="approved" />
                        <StatCard title="Odrzucone" value={stats?.rejected || 0} color="red" IconComponent={Icons.XCircle} filter="rejected" />
                    </div>

                    {selectedFilter && (
                        <div className="mt-8">
                            <h3 className="text-2xl font-bold mb-4 text-gray-800">
                                {selectedFilter === 'all' && 'Wszystkie wnioski'}
                                {selectedFilter === 'pending' && 'Wnioski oczekujące'}
                                {selectedFilter === 'approved' && 'Wnioski zaakceptowane'}
                                {selectedFilter === 'rejected' && 'Wnioski odrzucone'}
                                <span className="text-gray-400 ml-2">({filteredRequests.length})</span>
                            </h3>

                            {filteredRequests.length === 0 ? (
                                <div className="text-center py-12 glass rounded-2xl shadow">
                                    <p className="text-gray-400 text-lg">Brak wniosków w tej kategorii</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {filteredRequests.map(req => (
                                        <div key={req.id} className="glass rounded-2xl shadow-lg p-4 md:p-6 hover-lift border border-gray-100">
                                            <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-3 flex-wrap">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${statusColors[req.status]}`}>
                                                            {req.status.toUpperCase()}
                                                        </span>
                                                        <span className="text-gray-400 text-sm">#{req.id}</span>
                                                    </div>
                                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4">
                                                        <div>
                                                            <p className="text-xs text-gray-500 mb-1">Pracownik</p>
                                                            <p className="font-semibold text-sm">{req.user_name}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-gray-500 mb-1">Data</p>
                                                            <p className="font-semibold text-sm">{req.date}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-gray-500 mb-1">Godziny</p>
                                                            <p className="font-semibold text-sm">{req.start_time} - {req.end_time}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-gray-500 mb-1">Przełożony</p>
                                                            <p className="font-semibold text-sm">{req.supervisor_name || '-'}</p>
                                                        </div>
                                                    </div>
                                                    {req.reason && (
                                                        <div className="mt-3 bg-gray-50 rounded-xl p-3">
                                                            <p className="text-xs text-gray-500 mb-1">Powód</p>
                                                            <p className="text-gray-700 text-sm">{req.reason}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // MY REQUESTS VIEW
        // ============================================
        const MyRequestsView = ({ user, showToast }) => {
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filter, setFilter] = useState('all');

            useEffect(() => {
                loadRequests();
            }, []);

            const loadRequests = async () => {
                try {
                    const res = await axios.get(`/api/requests?employee_id=${user.id}`);
                    setRequests(res.data);
                } catch (err) {
                    showToast('Błąd wczytywania wniosków', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleCancel = async (id) => {
                if (!confirm('Czy na pewno chcesz anulować ten wniosek?')) return;

                try {
                    await axios.delete(`/api/requests/${id}`);
                    showToast('Wniosek anulowany', 'success');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd anulowania wniosku', 'error');
                }
            };

            const filteredRequests = filter === 'all'
                ? requests
                : requests.filter(r => r.status === filter);

            const statusColors = {
                'oczekujący': 'bg-amber-100 text-amber-800 border-amber-200',
                'zaakceptowany': 'bg-emerald-100 text-emerald-800 border-emerald-200',
                'odrzucony': 'bg-red-100 text-red-800 border-red-200',
                'anulowany': 'bg-gray-100 text-gray-800 border-gray-200'
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-4 md:p-8 content-wrapper">
                    <div className="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                        <h2 className="text-3xl font-bold text-gray-800">Moje wnioski</h2>
                        <select
                            value={filter}
                            onChange={(e) => setFilter(e.target.value)}
                            className="px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 bg-white"
                        >
                            <option value="all">Wszystkie</option>
                            <option value="oczekujący">Oczekujące</option>
                            <option value="zaakceptowany">Zaakceptowane</option>
                            <option value="odrzucony">Odrzucone</option>
                            <option value="anulowany">Anulowane</option>
                        </select>
                    </div>

                    {filteredRequests.length === 0 ? (
                        <div className="text-center py-16 glass rounded-2xl shadow">
                            <p className="text-gray-400 text-lg">Brak wniosków do wyświetlenia</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {filteredRequests.map(req => (
                                <div key={req.id} className="glass rounded-2xl shadow-lg p-4 md:p-6 border border-gray-100">
                                    <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-3 mb-3 flex-wrap">
                                                <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${statusColors[req.status]}`}>
                                                    {req.status.toUpperCase()}
                                                </span>
                                                <span className="text-gray-400 text-sm">#{req.id}</span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3 mb-3">
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Data</p>
                                                    <p className="font-semibold text-sm">{req.date}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Godziny</p>
                                                    <p className="font-semibold text-sm">{req.time_out} - {req.time_return}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Przełożony</p>
                                                    <p className="font-semibold text-sm">{req.manager.name}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Utworzono</p>
                                                    <p className="font-semibold text-sm">{new Date(req.created_at).toLocaleDateString('pl-PL')}</p>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-xl">
                                                <p className="text-xs text-gray-500 mb-1">Powód</p>
                                                <p className="text-gray-800 text-sm">{req.reason}</p>
                                            </div>
                                            {req.manager_comment && (
                                                <div className="bg-red-50 p-3 rounded-xl mt-3 border border-red-200">
                                                    <p className="text-xs text-red-700 mb-1 font-semibold">Komentarz managera</p>
                                                    <p className="text-red-900 text-sm">{req.manager_comment}</p>
                                                </div>
                                            )}
                                        </div>
                                        {req.status === 'oczekujący' && (
                                            <button
                                                onClick={() => handleCancel(req.id)}
                                                className="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-medium text-sm w-full md:w-auto"
                                            >
                                                Anuluj
                                            </button>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // NEW REQUEST VIEW
        // ============================================
        const NewRequestView = ({ user, showToast, setView }) => {
            const [form, setForm] = useState({
                date: new Date().toISOString().split('T')[0],
                time_out: '',
                time_return: '',
                reason: ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();

                if (form.time_return <= form.time_out) {
                    showToast('Godzina powrotu musi być późniejsza niż wyjście!', 'error');
                    return;
                }

                if (form.reason.length < 10) {
                    showToast('Powód musi mieć minimum 10 znaków', 'error');
                    return;
                }

                setLoading(true);

                try {
                    await axios.post('/api/requests', form);
                    showToast('Wniosek złożony pomyślnie!', 'success');
                    setForm({
                        date: new Date().toISOString().split('T')[0],
                        time_out: '',
                        time_return: '',
                        reason: ''
                    });
                    setView('my-requests');
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd składania wniosku', 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="p-4 md:p-8 max-w-3xl mx-auto content-wrapper">
                    <h2 className="text-3xl font-bold mb-2 text-gray-800">Nowy wniosek</h2>
                    <p className="mb-6 text-gray-500">Wniosek zostanie automatycznie wysłany do Twojego przełożonego</p>

                    <form onSubmit={handleSubmit} className="glass rounded-2xl shadow-lg p-4 md:p-8 space-y-6 border border-gray-100">
                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Data *</label>
                            <input
                                type="date"
                                value={form.date}
                                onChange={(e) => setForm({...form, date: e.target.value})}
                                min={new Date().toISOString().split('T')[0]}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700 text-sm">Wyjście *</label>
                                <input
                                    type="time"
                                    value={form.time_out}
                                    onChange={(e) => setForm({...form, time_out: e.target.value})}
                                    className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700 text-sm">Powrót *</label>
                                <input
                                    type="time"
                                    value={form.time_return}
                                    onChange={(e) => setForm({...form, time_return: e.target.value})}
                                    className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                    required
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Powód * (min. 10 znaków)</label>
                            <textarea
                                value={form.reason}
                                onChange={(e) => setForm({...form, reason: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                rows="4"
                                placeholder="Opisz powód wyjścia..."
                                required
                                minLength="10"
                            ></textarea>
                            <p className="text-sm text-gray-500 mt-1">{form.reason.length} / 10 znaków</p>
                        </div>

                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full px-6 py-3 gradient-emerald text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition disabled:opacity-50 flex items-center justify-center gap-2"
                        >
                            {loading ? (
                                <>
                                    <div className="loading-spinner border-white"></div>
                                    <span>Wysyłanie...</span>
                                </>
                            ) : 'Złóż wniosek'}
                        </button>
                    </form>
                </div>
            );
        };

        // ============================================
        // PENDING REQUESTS VIEW (Manager/Admin)
        // ============================================
        const PendingRequestsView = ({ user, showToast }) => {
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [rejectModal, setRejectModal] = useState(null);
            const [comment, setComment] = useState('');

            useEffect(() => {
                loadRequests();
            }, []);

            const loadRequests = async () => {
                try {
                    let endpoint = '/api/requests?status=oczekujący';
                    if (user.role === 'manager') {
                        endpoint += `&supervisor_id=${user.id}`;
                    }
                    const res = await axios.get(endpoint);
                    setRequests(res.data);
                } catch (err) {
                    showToast('Błąd wczytywania wniosków', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleAccept = async (id) => {
                if (!confirm('Czy na pewno zaakceptować ten wniosek?')) return;

                try {
                    await axios.put(`/api/requests/${id}/accept`);
                    showToast('Wniosek zaakceptowany!', 'success');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd akceptacji', 'error');
                }
            };

            const handleReject = async () => {
                if (!rejectModal) return;

                try {
                    await axios.put(`/api/requests/${rejectModal.id}/reject`, { comment });
                    showToast('Wniosek odrzucony', 'success');
                    setRejectModal(null);
                    setComment('');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd odrzucenia', 'error');
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-4 md:p-8 content-wrapper">
                    <h2 className="text-3xl font-bold mb-2 text-gray-800">
                        Oczekujące wnioski
                        <span className="ml-4 text-amber-600">({requests.length})</span>
                    </h2>
                    <p className="text-gray-500 mb-6">Wnioski wymagające Twojej decyzji</p>

                    {requests.length === 0 ? (
                        <div className="text-center py-16 glass rounded-2xl shadow border border-gray-100">
                            <p className="text-gray-400 text-lg">✅ Brak oczekujących wniosków</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {requests.map(req => (
                                <div key={req.id} className="glass rounded-2xl shadow-lg p-4 md:p-6 border border-gray-100">
                                    <div className="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
                                        <div className="flex-1">
                                            <h3 className="text-xl font-bold mb-3 text-gray-800">{req.employee.name}</h3>
                                            <div className="grid grid-cols-2 gap-3 mb-3">
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Data</p>
                                                    <p className="font-semibold text-sm">{req.date}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Godziny</p>
                                                    <p className="font-semibold text-sm">{req.time_out} - {req.time_return}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Email</p>
                                                    <p className="font-semibold text-sm">{req.employee.email}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-500 mb-1">Złożono</p>
                                                    <p className="font-semibold text-sm">{new Date(req.created_at).toLocaleDateString('pl-PL')}</p>
                                                </div>
                                            </div>
                                            <div className="bg-amber-50 p-4 rounded-xl border border-amber-200">
                                                <p className="text-xs text-amber-700 mb-1 font-semibold">Powód</p>
                                                <p className="text-amber-900 text-sm">{req.reason}</p>
                                            </div>
                                        </div>
                                        <div className="flex md:flex-col gap-2 w-full md:w-auto">
                                            <button
                                                onClick={() => handleAccept(req.id)}
                                                className="flex-1 md:flex-none px-6 py-3 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 transition font-semibold text-sm"
                                            >
                                                ✅ Zaakceptuj
                                            </button>
                                            <button
                                                onClick={() => setRejectModal(req)}
                                                className="flex-1 md:flex-none px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-semibold text-sm"
                                            >
                                                ❌ Odrzuć
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Reject Modal */}
                    {rejectModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-2xl shadow-2xl p-6 md:p-8 max-w-md w-full border border-gray-200 modal-content">
                                <h3 className="text-2xl font-bold mb-4 text-gray-800">Odrzuć wniosek</h3>
                                <p className="text-gray-600 mb-4">Wniosek od: <strong>{rejectModal.employee.name}</strong></p>
                                <textarea
                                    value={comment}
                                    onChange={(e) => setComment(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 mb-4"
                                    rows="4"
                                    placeholder="Komentarz (opcjonalny)..."
                                ></textarea>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => {
                                            setRejectModal(null);
                                            setComment('');
                                        }}
                                        className="flex-1 px-4 py-3 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition font-semibold"
                                    >
                                        Anuluj
                                    </button>
                                    <button
                                        onClick={handleReject}
                                        className="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-semibold"
                                    >
                                        Odrzuć
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // USERS VIEW (Admin only)
        // ============================================
        const UsersView = ({ showToast }) => {
            const [users, setUsers] = useState([]);
            const [managers, setManagers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editModal, setEditModal] = useState(null);
            const [addModal, setAddModal] = useState(false);
            const [reassignModal, setReassignModal] = useState(null);
            const [newSupervisorId, setNewSupervisorId] = useState(null);
            const [newUser, setNewUser] = useState({
                email: '',
                password: '',
                first_name: '',
                last_name: '',
                role: 'pracownik',
                supervisor_id: null
            });

            useEffect(() => {
                loadUsers();
                loadManagers();
            }, []);

            const loadUsers = async () => {
                try {
                    const res = await axios.get('/api/users');
                    setUsers(res.data);
                } catch (err) {
                    showToast('Błąd wczytywania użytkowników', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const loadManagers = async () => {
                try {
                    const res = await axios.get('/api/users');
                    setManagers(res.data);
                } catch (err) {
                    console.error('Error loading managers:', err);
                }
            };

            const handleAddUser = async (e) => {
                e.preventDefault();
                try {
                    await axios.post('/api/users', newUser);
                    showToast('Użytkownik dodany!', 'success');
                    setAddModal(false);
                    setNewUser({
                        email: '',
                        password: '',
                        first_name: '',
                        last_name: '',
                        role: 'pracownik',
                        supervisor_id: null
                    });
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd dodawania', 'error');
                }
            };

            const handleUpdateUser = async (e) => {
                e.preventDefault();
                try {
                    const updateData = {
                        first_name: editModal.first_name,
                        last_name: editModal.last_name,
                        role: editModal.role,
                        supervisor_id: editModal.supervisor_id
                    };
                    if (editModal.password) {
                        updateData.password = editModal.password;
                    }
                    await axios.put(`/api/users/${editModal.id}`, updateData);
                    showToast('Użytkownik zaktualizowany!', 'success');
                    setEditModal(null);
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd aktualizacji', 'error');
                }
            };

            const handleDelete = async (userId) => {
                if (!confirm('Czy na pewno usunąć tego użytkownika?')) return;

                try {
                    await axios.delete(`/api/users/${userId}`);
                    showToast('Użytkownik usunięty', 'success');
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd usuwania', 'error');
                }
            };

            const handleToggleActive = async (user) => {
                if (!user.is_active) {
                    if (!confirm(`Czy na pewno aktywować użytkownika ${user.first_name} ${user.last_name}?`)) return;

                    try {
                        await axios.put(`/api/users/${user.id}`, { is_active: true });
                        showToast('Użytkownik aktywowany', 'success');
                        loadUsers();
                        loadManagers();
                    } catch (err) {
                        showToast(err.response?.data?.error || 'Błąd aktywacji', 'error');
                    }
                    return;
                }

                try {
                    const res = await axios.get(`/api/users/${user.id}/subordinates`);

                    if (res.data.count > 0) {
                        setReassignModal({
                            user: user,
                            subordinates: res.data.subordinates
                        });
                        setNewSupervisorId(null);
                    } else {
                        if (!confirm(`Czy na pewno deaktywować użytkownika ${user.first_name} ${user.last_name}?`)) return;

                        await axios.put(`/api/users/${user.id}`, { is_active: false });
                        showToast('Użytkownik deaktywowany', 'success');
                        loadUsers();
                        loadManagers();
                    }
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd deaktywacji', 'error');
                }
            };

            const handleReassignAndDeactivate = async () => {
                if (!newSupervisorId) {
                    showToast('Wybierz nowego przełożonego', 'error');
                    return;
                }

                try {
                    await axios.post(`/api/users/${reassignModal.user.id}/reassign-subordinates`, {
                        new_supervisor_id: parseInt(newSupervisorId)
                    });

                    await axios.put(`/api/users/${reassignModal.user.id}`, { is_active: false });

                    showToast(`Pracownicy przepisani i użytkownik deaktywowany`, 'success');
                    setReassignModal(null);
                    setNewSupervisorId(null);
                    loadUsers();
                    loadManagers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd przepisywania', 'error');
                }
            };

            if (loading) return <LoadingSpinner />;

            const roleLabels = {
                'pracownik': 'Pracownik',
                'manager': 'Manager',
                'admin': 'Admin'
            };

            return (
                <div className="p-4 md:p-8 content-wrapper">
                    <div className="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                        <h2 className="text-3xl font-bold text-gray-800">Użytkownicy <span className="text-gray-400">({users.length})</span></h2>
                        <button
                            onClick={() => setAddModal(true)}
                            className="px-6 py-3 gradient-emerald text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition"
                        >
                            <span className="flex items-center gap-2 justify-center">
                                <Icons.Plus />
                                <span>Dodaj użytkownika</span>
                            </span>
                        </button>
                    </div>

                    {/* Desktop Table */}
                    <div className="hidden md:block glass rounded-2xl shadow-lg overflow-hidden border border-gray-100">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Imię i nazwisko</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Email</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Rola</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Przełożony</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Status</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Akcje</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {users.map(user => (
                                    <tr key={user.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 font-semibold">{user.first_name} {user.last_name}</td>
                                        <td className="px-6 py-4 text-gray-600">{user.email}</td>
                                        <td className="px-6 py-4">
                                            <span className="px-3 py-1 rounded-full text-xs font-semibold bg-emerald-100 text-emerald-800">
                                                {roleLabels[user.role]}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-gray-600">
                                            {user.supervisor ? user.supervisor.name : '-'}
                                        </td>
                                        <td className="px-6 py-4">
                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${user.is_active ? 'bg-emerald-100 text-emerald-800' : 'bg-gray-100 text-gray-800'}`}>
                                                {user.is_active ? 'Aktywny' : 'Nieaktywny'}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4">
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => setEditModal(user)}
                                                    className="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm"
                                                >
                                                    Edytuj
                                                </button>
                                                <button
                                                    onClick={() => handleToggleActive(user)}
                                                    className={`px-3 py-1 ${user.is_active ? 'bg-orange-500 hover:bg-orange-600' : 'bg-emerald-500 hover:bg-emerald-600'} text-white rounded-lg transition text-sm`}
                                                >
                                                    {user.is_active ? 'Deaktywuj' : 'Aktywuj'}
                                                </button>
                                                <button
                                                    onClick={() => handleDelete(user.id)}
                                                    className="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm"
                                                    title="Usuwa tylko użytkowników bez wniosków"
                                                >
                                                    Usuń
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Mobile Cards */}
                    <div className="md:hidden space-y-4">
                        {users.map(user => (
                            <div key={user.id} className="glass rounded-2xl p-4 border border-gray-100 shadow-lg">
                                <div className="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 className="font-bold text-gray-800">{user.first_name} {user.last_name}</h3>
                                        <p className="text-sm text-gray-500">{user.email}</p>
                                    </div>
                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${user.is_active ? 'bg-emerald-100 text-emerald-800' : 'bg-gray-100 text-gray-800'}`}>
                                        {user.is_active ? 'Aktywny' : 'Nieaktywny'}
                                    </span>
                                </div>
                                <div className="space-y-2 mb-3">
                                    <p className="text-sm"><span className="text-gray-500">Rola:</span> <span className="font-medium">{roleLabels[user.role]}</span></p>
                                    <p className="text-sm"><span className="text-gray-500">Przełożony:</span> <span className="font-medium">{user.supervisor ? user.supervisor.name : '-'}</span></p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setEditModal(user)}
                                        className="flex-1 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm"
                                    >
                                        Edytuj
                                    </button>
                                    <button
                                        onClick={() => handleToggleActive(user)}
                                        className={`flex-1 px-3 py-2 ${user.is_active ? 'bg-orange-500 hover:bg-orange-600' : 'bg-emerald-500 hover:bg-emerald-600'} text-white rounded-lg transition text-sm`}
                                    >
                                        {user.is_active ? 'Deaktywuj' : 'Aktywuj'}
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Add User Modal */}
                    {addModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-2xl p-6 md:p-8 max-w-md w-full border border-gray-200 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-gray-800">Dodaj użytkownika</h3>
                                <form onSubmit={handleAddUser} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Email *</label>
                                        <input
                                            type="email"
                                            required
                                            value={newUser.email}
                                            onChange={(e) => setNewUser({...newUser, email: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Hasło * (min. 8 znaków)</label>
                                        <input
                                            type="password"
                                            required
                                            minLength="8"
                                            value={newUser.password}
                                            onChange={(e) => setNewUser({...newUser, password: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Imię *</label>
                                        <input
                                            type="text"
                                            required
                                            value={newUser.first_name}
                                            onChange={(e) => setNewUser({...newUser, first_name: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Nazwisko *</label>
                                        <input
                                            type="text"
                                            required
                                            value={newUser.last_name}
                                            onChange={(e) => setNewUser({...newUser, last_name: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Rola *</label>
                                        <select
                                            required
                                            value={newUser.role}
                                            onChange={(e) => setNewUser({...newUser, role: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        >
                                            <option value="pracownik">Pracownik</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Przełożony</label>
                                        <select
                                            value={newUser.supervisor_id || ''}
                                            onChange={(e) => setNewUser({...newUser, supervisor_id: e.target.value ? parseInt(e.target.value) : null})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        >
                                            <option value="">Brak przełożonego</option>
                                            {managers.filter(m => m.is_active).map(m => (
                                                <option key={m.id} value={m.id}>{m.first_name} {m.last_name} ({m.role})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            type="submit"
                                            className="flex-1 px-6 py-3 gradient-emerald text-white rounded-lg hover:shadow-lg transition font-semibold"
                                        >
                                            Dodaj
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setAddModal(false)}
                                            className="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold"
                                        >
                                            Anuluj
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Edit User Modal */}
                    {editModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-2xl p-6 md:p-8 max-w-md w-full border border-gray-200 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6 text-gray-800">Edytuj użytkownika</h3>
                                <form onSubmit={handleUpdateUser} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Email</label>
                                        <input
                                            type="text"
                                            disabled
                                            value={editModal.email}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg bg-gray-100"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Nowe hasło (pozostaw puste aby nie zmieniać)</label>
                                        <input
                                            type="password"
                                            minLength="8"
                                            value={editModal.password || ''}
                                            onChange={(e) => setEditModal({...editModal, password: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Imię *</label>
                                        <input
                                            type="text"
                                            required
                                            value={editModal.first_name}
                                            onChange={(e) => setEditModal({...editModal, first_name: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Nazwisko *</label>
                                        <input
                                            type="text"
                                            required
                                            value={editModal.last_name}
                                            onChange={(e) => setEditModal({...editModal, last_name: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Rola *</label>
                                        <select
                                            required
                                            value={editModal.role}
                                            onChange={(e) => setEditModal({...editModal, role: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        >
                                            <option value="pracownik">Pracownik</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Przełożony</label>
                                        <select
                                            value={editModal.supervisor_id || ''}
                                            onChange={(e) => setEditModal({...editModal, supervisor_id: e.target.value ? parseInt(e.target.value) : null})}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                        >
                                            <option value="">Brak przełożonego</option>
                                            {managers.filter(m => m.is_active && m.id !== editModal.id).map(m => (
                                                <option key={m.id} value={m.id}>{m.first_name} {m.last_name} ({m.role})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            type="submit"
                                            className="flex-1 px-6 py-3 gradient-emerald text-white rounded-lg hover:shadow-lg transition font-semibold"
                                        >
                                            Zapisz
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setEditModal(null)}
                                            className="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold"
                                        >
                                            Anuluj
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Reassign Subordinates Modal */}
                    {reassignModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-2xl p-6 md:p-8 max-w-2xl w-full border border-gray-200 modal-content max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-4 text-orange-600">⚠️ Przepisz pracowników</h3>

                                <div className="mb-6 p-4 bg-orange-50 border-l-4 border-orange-500 rounded">
                                    <p className="font-semibold mb-2">
                                        Użytkownik <span className="text-orange-700">{reassignModal.user.first_name} {reassignModal.user.last_name}</span> jest przełożonym dla <span className="text-orange-700">{reassignModal.subordinates.length}</span> pracowników:
                                    </p>
                                    <ul className="list-disc list-inside space-y-1 text-sm">
                                        {reassignModal.subordinates.map(sub => (
                                            <li key={sub.id}>{sub.first_name} {sub.last_name} ({sub.email})</li>
                                        ))}
                                    </ul>
                                </div>

                                <p className="mb-4 text-gray-700">
                                    Aby deaktywować tego użytkownika, musisz najpierw przypisać nowego przełożonego dla tych pracowników:
                                </p>

                                <div className="mb-6">
                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Nowy przełożony *</label>
                                    <select
                                        value={newSupervisorId || ''}
                                        onChange={(e) => setNewSupervisorId(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                                        required
                                    >
                                        <option value="">-- Wybierz przełożonego --</option>
                                        {managers.filter(m => m.is_active && m.id !== reassignModal.user.id).map(m => (
                                            <option key={m.id} value={m.id}>
                                                {m.first_name} {m.last_name} ({m.role})
                                            </option>
                                        ))}
                                    </select>
                                    <p className="text-xs text-gray-500 mt-1">
                                        Wszyscy powyżsi pracownicy zostaną przypisani do wybranego przełożonego
                                    </p>
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={handleReassignAndDeactivate}
                                        className="flex-1 px-6 py-3 bg-orange-500 text-white rounded-xl font-semibold hover:bg-orange-600 transition"
                                    >
                                        Przepisz i deaktywuj
                                    </button>
                                    <button
                                        onClick={() => {
                                            setReassignModal(null);
                                            setNewSupervisorId(null);
                                        }}
                                        className="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition"
                                    >
                                        Anuluj
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // SETTINGS VIEW (Admin only)
        // ============================================
        const SettingsView = ({ showToast }) => {
            const [config, setConfig] = useState({
                server: '',
                port: 587,
                use_ssl: true,
                login: '',
                password: '',
                email_from: ''
            });
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                loadConfig();
            }, []);

            const loadConfig = async () => {
                try {
                    const res = await axios.get('/api/smtp-config');
                    setConfig(res.data);
                } catch (err) {
                    showToast('Błąd wczytywania konfiguracji', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleSave = async (e) => {
                e.preventDefault();
                setSaving(true);

                try {
                    await axios.post('/api/smtp-config', config);
                    showToast('Konfiguracja zapisana!', 'success');
                } catch (err) {
                    showToast(err.response?.data?.error || 'Błąd zapisu', 'error');
                } finally {
                    setSaving(false);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-4 md:p-8 max-w-3xl mx-auto content-wrapper">
                    <h2 className="text-3xl font-bold mb-2 text-gray-800">Ustawienia SMTP</h2>
                    <p className="text-gray-500 mb-6">Skonfiguruj serwer email dla powiadomień</p>

                    <form onSubmit={handleSave} className="glass rounded-2xl shadow-lg p-4 md:p-8 space-y-6 border border-gray-100">
                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Server</label>
                            <input
                                type="text"
                                value={config.server || ''}
                                onChange={(e) => setConfig({...config, server: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                placeholder="smtp.gmail.com"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700 text-sm">Port</label>
                                <input
                                    type="number"
                                    value={config.port}
                                    onChange={(e) => setConfig({...config, port: parseInt(e.target.value)})}
                                    className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700 text-sm">Use SSL</label>
                                <select
                                    value={config.use_ssl.toString()}
                                    onChange={(e) => setConfig({...config, use_ssl: e.target.value === 'true'})}
                                    className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                >
                                    <option value="true">Tak</option>
                                    <option value="false">Nie</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Login</label>
                            <input
                                type="text"
                                value={config.login || ''}
                                onChange={(e) => setConfig({...config, login: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                placeholder="email@example.com"
                            />
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Password</label>
                            <input
                                type="password"
                                value={config.password || ''}
                                onChange={(e) => setConfig({...config, password: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                placeholder="••••••••"
                            />
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700 text-sm">Email From</label>
                            <input
                                type="email"
                                value={config.email_from || ''}
                                onChange={(e) => setConfig({...config, email_from: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                placeholder="system@firma.pl"
                            />
                        </div>

                        <button
                            type="submit"
                            disabled={saving}
                            className="w-full px-6 py-3 gradient-emerald text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition disabled:opacity-50 flex items-center justify-center gap-2"
                        >
                            {saving ? (
                                <>
                                    <div className="loading-spinner border-white"></div>
                                    <span>Zapisywanie...</span>
                                </>
                            ) : 'Zapisz konfigurację'}
                        </button>
                    </form>
                </div>
            );
        };

        // ============================================
        // AUDIT LOG VIEW (Admin only)
        // ============================================
        const AuditLogView = ({ showToast }) => {
            const [logs, setLogs] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadLogs();
            }, []);

            const loadLogs = async () => {
                try {
                    const res = await axios.get('/api/audit-logs?limit=50');
                    setLogs(res.data);
                } catch (err) {
                    showToast('Błąd wczytywania logów', 'error');
                } finally {
                    setLoading(false);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-4 md:p-8 content-wrapper">
                    <h2 className="text-3xl font-bold mb-6 text-gray-800">Audit Log <span className="text-gray-400">({logs.length})</span></h2>

                    {/* Desktop Table */}
                    <div className="hidden md:block glass rounded-2xl shadow-lg overflow-hidden border border-gray-100">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Data</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Użytkownik</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Akcja</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Szczegóły</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {logs.map(log => (
                                    <tr key={log.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 text-sm text-gray-600">
                                            {new Date(log.timestamp).toLocaleString('pl-PL')}
                                        </td>
                                        <td className="px-6 py-4 font-semibold">{log.user}</td>
                                        <td className="px-6 py-4">
                                            <span className="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                                {log.action}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-sm text-gray-600">{log.details || '-'}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Mobile Cards */}
                    <div className="md:hidden space-y-4">
                        {logs.map(log => (
                            <div key={log.id} className="glass rounded-2xl p-4 border border-gray-100 shadow-lg">
                                <div className="flex justify-between items-start mb-2">
                                    <p className="font-bold text-gray-800">{log.user}</p>
                                    <span className="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                        {log.action}
                                    </span>
                                </div>
                                <p className="text-sm text-gray-500 mb-2">{new Date(log.timestamp).toLocaleString('pl-PL')}</p>
                                <p className="text-sm text-gray-700">{log.details || '-'}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ============================================
        // MAIN APP
        // ============================================
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [toast, setToast] = useState(null);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            useEffect(() => {
                const token = localStorage.getItem('token');
                if (token) {
                    loadCurrentUser();
                }
            }, []);

            const loadCurrentUser = async () => {
                try {
                    const res = await axios.get('/api/me');
                    setUser(res.data);
                } catch (err) {
                    console.error('Failed to load user:', err);
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                }
            };

            const showToast = (message, type = 'success') => {
                setToast({ message, type });
            };

            const handleLogout = async () => {
                try {
                    await axios.post('/api/logout');
                } catch (err) {
                    console.error('Logout error:', err);
                } finally {
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                    setUser(null);
                    setView('dashboard');
                }
            };

            if (!user) {
                return <LoginView onLogin={setUser} />;
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <MobileHeader
                        user={user}
                        onMenuClick={() => setMobileMenuOpen(true)}
                        onLogout={handleLogout}
                    />
                    <div className="flex">
                        <Sidebar
                            activeView={view}
                            setView={setView}
                            role={user.role}
                            user={user}
                            onLogout={handleLogout}
                            mobileOpen={mobileMenuOpen}
                            setMobileOpen={setMobileMenuOpen}
                        />
                        <div className="flex-1 md:ml-0">
                            {view === 'dashboard' && <DashboardView user={user} />}
                            {view === 'new-request' && <NewRequestView user={user} showToast={showToast} setView={setView} />}
                            {view === 'my-requests' && <MyRequestsView user={user} showToast={showToast} />}
                            {view === 'pending' && <PendingRequestsView user={user} showToast={showToast} />}
                            {view === 'users' && <UsersView showToast={showToast} />}
                            {view === 'settings' && <SettingsView showToast={showToast} />}
                            {view === 'audit' && <AuditLogView showToast={showToast} />}
                        </div>
                    </div>

                    <MobileBottomNav activeView={view} setView={setView} role={user.role} />

                    <Footer />

                    {/* Floating Action Button (Mobile only) */}
                    {['pracownik', 'manager', 'admin'].includes(user.role) && (
                        <button
                            onClick={() => setView('new-request')}
                            className="fab gradient-emerald text-white"
                        >
                            <Icons.Plus />
                        </button>
                    )}

                    {toast && (
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}
                </div>
            );
        };

        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
