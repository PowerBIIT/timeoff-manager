<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeOff Manager</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // ============================================
        // AXIOS SETUP
        // ============================================
        axios.defaults.baseURL = window.location.origin;

        // Add token to requests if available
        const token = localStorage.getItem('token');
        if (token) {
            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
        }

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================
        const Toast = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };

            return (
                <div className={`toast ${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl max-w-md`}>
                    <div className="flex items-center gap-3">
                        <span className="text-lg font-semibold">{message}</span>
                        <button onClick={onClose} className="ml-4 text-white hover:text-gray-200">
                            ‚úï
                        </button>
                    </div>
                </div>
            );
        };

        // ============================================
        // LOADING SPINNER
        // ============================================
        const LoadingSpinner = () => (
            <div className="flex justify-center items-center py-8">
                <div className="loading-spinner"></div>
            </div>
        );

        // ============================================
        // LOGIN VIEW
        // ============================================
        const LoginView = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    const res = await axios.post('/api/login', { email, password });
                    localStorage.setItem('token', res.data.token);
                    axios.defaults.headers.common['Authorization'] = `Bearer ${res.data.token}`;
                    onLogin(res.data.user);
                } catch (err) {
                    setError(err.response?.data?.error || 'B≈ÇƒÖd logowania');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center gradient-bg p-4">
                    <div className="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
                        <h1 className="text-4xl font-bold text-center mb-2 bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
                            TimeOff Manager
                        </h1>
                        <p className="text-center text-gray-500 mb-8">Zaloguj siƒô do systemu</p>

                        {error && (
                            <div className="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
                                <p className="text-red-700">{error}</p>
                            </div>
                        )}

                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label className="block text-gray-700 font-semibold mb-2">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    placeholder="email@firma.pl"
                                    required
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-gray-700 font-semibold mb-2">Has≈Ço</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    required
                                />
                            </div>

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full px-6 py-3 gradient-bg text-white rounded-xl font-semibold hover:opacity-90 transition disabled:opacity-50 flex items-center justify-center gap-2"
                            >
                                {loading ? (
                                    <>
                                        <div className="loading-spinner border-white"></div>
                                        <span>Logowanie...</span>
                                    </>
                                ) : 'Zaloguj siƒô'}
                            </button>
                        </form>

                        <div className="mt-6 p-4 bg-gray-50 rounded-xl">
                            <p className="text-xs text-gray-600 mb-2 font-semibold">Konta testowe:</p>
                            <p className="text-xs text-gray-500">Admin: admin@firma.pl / admin123</p>
                            <p className="text-xs text-gray-500">Manager: manager@firma.pl / manager123</p>
                            <p className="text-xs text-gray-500">Pracownik: jan@firma.pl / jan123</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================
        // NAVBAR
        // ============================================
        const Navbar = ({ user, onLogout }) => {
            const handleLogout = async () => {
                try {
                    await axios.post('/api/logout');
                } catch (err) {
                    console.error('Logout error:', err);
                } finally {
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                    onLogout();
                }
            };

            const roleLabels = {
                'pracownik': 'Pracownik',
                'manager': 'Manager',
                'admin': 'Administrator'
            };

            return (
                <nav className="gradient-bg text-white px-6 py-4 shadow-lg">
                    <div className="max-w-7xl mx-auto flex justify-between items-center">
                        <div>
                            <h1 className="text-2xl font-bold">TimeOff Manager</h1>
                            <p className="text-sm opacity-90">System zarzƒÖdzania wnioskami</p>
                        </div>
                        <div className="flex items-center gap-6">
                            <div className="text-right">
                                <p className="font-semibold">{user.first_name} {user.last_name}</p>
                                <p className="text-sm opacity-90">{roleLabels[user.role]}</p>
                            </div>
                            <button
                                onClick={handleLogout}
                                className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition"
                            >
                                Wyloguj
                            </button>
                        </div>
                    </div>
                </nav>
            );
        };

        // ============================================
        // SIDEBAR
        // ============================================
        const Sidebar = ({ activeView, setView, role }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'üìä', roles: ['pracownik', 'manager', 'admin'] },
                { id: 'new-request', label: 'Nowy wniosek', icon: '‚ûï', roles: ['pracownik', 'manager', 'admin'] },
                { id: 'my-requests', label: 'Moje wnioski', icon: 'üìù', roles: ['pracownik', 'manager', 'admin'] },
                { id: 'pending', label: 'OczekujƒÖce', icon: '‚è≥', roles: ['manager', 'admin'] },
                { id: 'users', label: 'U≈ºytkownicy', icon: 'üë•', roles: ['admin'] },
                { id: 'settings', label: 'Ustawienia', icon: '‚öôÔ∏è', roles: ['admin'] },
                { id: 'audit', label: 'Audit Log', icon: 'üìú', roles: ['admin'] },
            ];

            return (
                <div className="w-64 bg-white shadow-lg min-h-screen p-4">
                    <nav className="space-y-2">
                        {menuItems.filter(item => item.roles.includes(role)).map(item => (
                            <button
                                key={item.id}
                                onClick={() => setView(item.id)}
                                className={`w-full text-left px-4 py-3 rounded-xl transition flex items-center gap-3 ${
                                    activeView === item.id
                                        ? 'gradient-bg text-white shadow-lg'
                                        : 'hover:bg-gray-100 text-gray-700'
                                }`}
                            >
                                <span className="text-xl">{item.icon}</span>
                                <span className="font-semibold">{item.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        // ============================================
        // DASHBOARD VIEW
        // ============================================
        const DashboardView = ({ user }) => {
            const [stats, setStats] = useState(null);
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedFilter, setSelectedFilter] = useState(null);

            useEffect(() => {
                loadStats();
            }, []);

            const loadStats = async () => {
                try {
                    let endpoint = '/api/requests';
                    if (user.role === 'pracownik') {
                        endpoint += `?employee_id=${user.id}`;
                    } else if (user.role === 'manager') {
                        endpoint += `?supervisor_id=${user.id}`;
                    }

                    const res = await axios.get(endpoint);
                    const allRequests = res.data;
                    setRequests(allRequests);

                    setStats({
                        total: allRequests.length,
                        pending: allRequests.filter(r => r.status === 'oczekujƒÖcy').length,
                        approved: allRequests.filter(r => r.status === 'zaakceptowany').length,
                        rejected: allRequests.filter(r => r.status === 'odrzucony').length,
                    });
                } catch (err) {
                    console.error('Error loading stats:', err);
                } finally {
                    setLoading(false);
                }
            };

            const handleCardClick = (filter) => {
                setSelectedFilter(selectedFilter === filter ? null : filter);
            };

            const getFilteredRequests = () => {
                if (!selectedFilter) return [];
                if (selectedFilter === 'all') return requests;
                if (selectedFilter === 'pending') return requests.filter(r => r.status === 'oczekujƒÖcy');
                if (selectedFilter === 'approved') return requests.filter(r => r.status === 'zaakceptowany');
                if (selectedFilter === 'rejected') return requests.filter(r => r.status === 'odrzucony');
                return [];
            };

            if (loading) return <LoadingSpinner />;

            const StatCard = ({ title, value, color, icon, filter }) => (
                <div
                    onClick={() => handleCardClick(filter)}
                    className={`bg-white rounded-2xl shadow-lg p-6 border-l-4 border-${color}-500 cursor-pointer transition-all hover:shadow-xl hover:scale-105 ${selectedFilter === filter ? 'ring-4 ring-' + color + '-300' : ''}`}
                >
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-gray-500 text-sm font-semibold mb-1">{title}</p>
                            <p className={`text-4xl font-bold text-${color}-600`}>{value}</p>
                        </div>
                        <span className="text-4xl opacity-20">{icon}</span>
                    </div>
                    {selectedFilter === filter && (
                        <div className="mt-3 text-xs text-gray-500 font-medium">
                            ‚ñº Kliknij ponownie aby ukryƒá
                        </div>
                    )}
                </div>
            );

            const statusColors = {
                'oczekujƒÖcy': 'bg-yellow-100 text-yellow-800',
                'zaakceptowany': 'bg-green-100 text-green-800',
                'odrzucony': 'bg-red-100 text-red-800',
            };

            const filteredRequests = getFilteredRequests();

            return (
                <div className="p-8">
                    <h2 className="text-3xl font-bold mb-2">Witaj, {user.first_name}!</h2>
                    <p className="text-gray-500 mb-8">Oto podsumowanie Twoich wniosk√≥w</p>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <StatCard title="Wszystkie wnioski" value={stats?.total || 0} color="blue" icon="üìä" filter="all" />
                        <StatCard title="OczekujƒÖce" value={stats?.pending || 0} color="yellow" icon="‚è≥" filter="pending" />
                        <StatCard title="Zaakceptowane" value={stats?.approved || 0} color="green" icon="‚úÖ" filter="approved" />
                        <StatCard title="Odrzucone" value={stats?.rejected || 0} color="red" icon="‚ùå" filter="rejected" />
                    </div>

                    {selectedFilter && (
                        <div className="mt-8">
                            <h3 className="text-2xl font-bold mb-4">
                                {selectedFilter === 'all' && 'Wszystkie wnioski'}
                                {selectedFilter === 'pending' && 'Wnioski oczekujƒÖce'}
                                {selectedFilter === 'approved' && 'Wnioski zaakceptowane'}
                                {selectedFilter === 'rejected' && 'Wnioski odrzucone'}
                                {' '}({filteredRequests.length})
                            </h3>

                            {filteredRequests.length === 0 ? (
                                <div className="text-center py-12 bg-white rounded-2xl shadow">
                                    <p className="text-gray-400 text-lg">Brak wniosk√≥w w tej kategorii</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {filteredRequests.map(req => (
                                        <div key={req.id} className="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-3">
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${statusColors[req.status]}`}>
                                                            {req.status.toUpperCase()}
                                                        </span>
                                                        <span className="text-gray-500">#{req.id}</span>
                                                    </div>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                        <div>
                                                            <p className="text-sm text-gray-500">Pracownik</p>
                                                            <p className="font-semibold">{req.user_name}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-sm text-gray-500">Data</p>
                                                            <p className="font-semibold">{req.date}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-sm text-gray-500">Godziny</p>
                                                            <p className="font-semibold">{req.start_time} - {req.end_time}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-sm text-gray-500">Prze≈Ço≈ºony</p>
                                                            <p className="font-semibold">{req.supervisor_name || '-'}</p>
                                                        </div>
                                                    </div>
                                                    {req.reason && (
                                                        <div className="mt-3">
                                                            <p className="text-sm text-gray-500">Pow√≥d</p>
                                                            <p className="text-gray-700">{req.reason}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // MY REQUESTS VIEW
        // ============================================
        const MyRequestsView = ({ user, showToast }) => {
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filter, setFilter] = useState('all');

            useEffect(() => {
                loadRequests();
            }, []);

            const loadRequests = async () => {
                try {
                    const res = await axios.get(`/api/requests?employee_id=${user.id}`);
                    setRequests(res.data);
                } catch (err) {
                    showToast('B≈ÇƒÖd wczytywania wniosk√≥w', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleCancel = async (id) => {
                if (!confirm('Czy na pewno chcesz anulowaƒá ten wniosek?')) return;

                try {
                    await axios.delete(`/api/requests/${id}`);
                    showToast('Wniosek anulowany', 'success');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd anulowania wniosku', 'error');
                }
            };

            const filteredRequests = filter === 'all'
                ? requests
                : requests.filter(r => r.status === filter);

            const statusColors = {
                'oczekujƒÖcy': 'bg-yellow-100 text-yellow-800',
                'zaakceptowany': 'bg-green-100 text-green-800',
                'odrzucony': 'bg-red-100 text-red-800',
                'anulowany': 'bg-gray-100 text-gray-800'
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold">Moje wnioski</h2>
                        <select
                            value={filter}
                            onChange={(e) => setFilter(e.target.value)}
                            className="px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                        >
                            <option value="all">Wszystkie</option>
                            <option value="oczekujƒÖcy">OczekujƒÖce</option>
                            <option value="zaakceptowany">Zaakceptowane</option>
                            <option value="odrzucony">Odrzucone</option>
                            <option value="anulowany">Anulowane</option>
                        </select>
                    </div>

                    {filteredRequests.length === 0 ? (
                        <div className="text-center py-16 bg-white rounded-2xl shadow">
                            <p className="text-gray-400 text-lg">Brak wniosk√≥w do wy≈õwietlenia</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {filteredRequests.map(req => (
                                <div key={req.id} className="bg-white rounded-2xl shadow-lg p-6">
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-3 mb-3">
                                                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${statusColors[req.status]}`}>
                                                    {req.status.toUpperCase()}
                                                </span>
                                                <span className="text-gray-500">#{req.id}</span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 mb-3">
                                                <div>
                                                    <p className="text-sm text-gray-500">Data</p>
                                                    <p className="font-semibold">{req.date}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Godziny</p>
                                                    <p className="font-semibold">{req.time_out} - {req.time_return}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Prze≈Ço≈ºony</p>
                                                    <p className="font-semibold">{req.manager.name}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Utworzono</p>
                                                    <p className="font-semibold">{new Date(req.created_at).toLocaleDateString('pl-PL')}</p>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-xl">
                                                <p className="text-sm text-gray-500 mb-1">Pow√≥d</p>
                                                <p className="text-gray-800">{req.reason}</p>
                                            </div>
                                            {req.manager_comment && (
                                                <div className="bg-red-50 p-3 rounded-xl mt-3 border-l-4 border-red-500">
                                                    <p className="text-sm text-red-700 mb-1 font-semibold">Komentarz managera</p>
                                                    <p className="text-red-900">{req.manager_comment}</p>
                                                </div>
                                            )}
                                        </div>
                                        {req.status === 'oczekujƒÖcy' && (
                                            <button
                                                onClick={() => handleCancel(req.id)}
                                                className="ml-4 px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition"
                                            >
                                                Anuluj
                                            </button>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // NEW REQUEST VIEW
        // ============================================
        const NewRequestView = ({ user, showToast, setView }) => {
            const [form, setForm] = useState({
                date: new Date().toISOString().split('T')[0],
                time_out: '',
                time_return: '',
                reason: ''
            });
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();

                // Validation
                if (form.time_return <= form.time_out) {
                    showToast('Godzina powrotu musi byƒá p√≥≈∫niejsza ni≈º wyj≈õcie!', 'error');
                    return;
                }

                if (form.reason.length < 10) {
                    showToast('Pow√≥d musi mieƒá minimum 10 znak√≥w', 'error');
                    return;
                }

                setLoading(true);

                try {
                    await axios.post('/api/requests', form);
                    showToast('Wniosek z≈Ço≈ºony pomy≈õlnie!', 'success');
                    setForm({
                        date: new Date().toISOString().split('T')[0],
                        time_out: '',
                        time_return: '',
                        reason: ''
                    });
                    setView('my-requests');
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd sk≈Çadania wniosku', 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="p-8 max-w-3xl mx-auto">
                    <h2 className="text-3xl font-bold mb-8">Nowy wniosek o wyj≈õcie</h2>
                    <p className="mb-6 text-gray-600">Wniosek zostanie automatycznie wys≈Çany do Twojego prze≈Ço≈ºonego</p>

                    <form onSubmit={handleSubmit} className="bg-white rounded-2xl shadow-lg p-8 space-y-6">
                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Data *</label>
                            <input
                                type="date"
                                value={form.date}
                                onChange={(e) => setForm({...form, date: e.target.value})}
                                min={new Date().toISOString().split('T')[0]}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700">Wyj≈õcie *</label>
                                <input
                                    type="time"
                                    value={form.time_out}
                                    onChange={(e) => setForm({...form, time_out: e.target.value})}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700">Powr√≥t *</label>
                                <input
                                    type="time"
                                    value={form.time_return}
                                    onChange={(e) => setForm({...form, time_return: e.target.value})}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    required
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Pow√≥d * (min. 10 znak√≥w)</label>
                            <textarea
                                value={form.reason}
                                onChange={(e) => setForm({...form, reason: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                rows="4"
                                placeholder="Opisz pow√≥d wyj≈õcia..."
                                required
                                minLength="10"
                            ></textarea>
                            <p className="text-sm text-gray-500 mt-1">{form.reason.length} / 10 znak√≥w</p>
                        </div>

                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full px-6 py-3 gradient-bg text-white rounded-xl font-semibold hover:opacity-90 transition disabled:opacity-50 flex items-center justify-center gap-2"
                        >
                            {loading ? (
                                <>
                                    <div className="loading-spinner border-white"></div>
                                    <span>Wysy≈Çanie...</span>
                                </>
                            ) : 'Z≈Ç√≥≈º wniosek'}
                        </button>
                    </form>
                </div>
            );
        };

        // ============================================
        // PENDING REQUESTS VIEW (Manager/Admin)
        // ============================================
        const PendingRequestsView = ({ user, showToast }) => {
            const [requests, setRequests] = useState([]);
            const [loading, setLoading] = useState(true);
            const [rejectModal, setRejectModal] = useState(null);
            const [comment, setComment] = useState('');

            useEffect(() => {
                loadRequests();
            }, []);

            const loadRequests = async () => {
                try {
                    let endpoint = '/api/requests?status=oczekujƒÖcy';
                    if (user.role === 'manager') {
                        endpoint += `&supervisor_id=${user.id}`;
                    }
                    const res = await axios.get(endpoint);
                    setRequests(res.data);
                } catch (err) {
                    showToast('B≈ÇƒÖd wczytywania wniosk√≥w', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleAccept = async (id) => {
                if (!confirm('Czy na pewno zaakceptowaƒá ten wniosek?')) return;

                try {
                    await axios.put(`/api/requests/${id}/accept`);
                    showToast('Wniosek zaakceptowany!', 'success');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd akceptacji', 'error');
                }
            };

            const handleReject = async () => {
                if (!rejectModal) return;

                try {
                    await axios.put(`/api/requests/${rejectModal.id}/reject`, { comment });
                    showToast('Wniosek odrzucony', 'success');
                    setRejectModal(null);
                    setComment('');
                    loadRequests();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd odrzucenia', 'error');
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-8">
                    <h2 className="text-3xl font-bold mb-2">
                        OczekujƒÖce wnioski
                        <span className="ml-4 text-yellow-600">({requests.length})</span>
                    </h2>
                    <p className="text-gray-500 mb-8">Wnioski wymagajƒÖce Twojej decyzji</p>

                    {requests.length === 0 ? (
                        <div className="text-center py-16 bg-white rounded-2xl shadow">
                            <p className="text-gray-400 text-lg">‚úÖ Brak oczekujƒÖcych wniosk√≥w</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {requests.map(req => (
                                <div key={req.id} className="bg-white rounded-2xl shadow-lg p-6">
                                    <div className="flex justify-between items-start gap-6">
                                        <div className="flex-1">
                                            <h3 className="text-xl font-bold mb-3">{req.employee.name}</h3>
                                            <div className="grid grid-cols-2 gap-4 mb-3">
                                                <div>
                                                    <p className="text-sm text-gray-500">Data</p>
                                                    <p className="font-semibold">{req.date}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Godziny</p>
                                                    <p className="font-semibold">{req.time_out} - {req.time_return}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Email</p>
                                                    <p className="font-semibold">{req.employee.email}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-gray-500">Z≈Ço≈ºono</p>
                                                    <p className="font-semibold">{new Date(req.created_at).toLocaleDateString('pl-PL')}</p>
                                                </div>
                                            </div>
                                            <div className="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-500">
                                                <p className="text-sm text-yellow-700 mb-1 font-semibold">Pow√≥d</p>
                                                <p className="text-yellow-900">{req.reason}</p>
                                            </div>
                                        </div>
                                        <div className="flex flex-col gap-2">
                                            <button
                                                onClick={() => handleAccept(req.id)}
                                                className="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition font-semibold"
                                            >
                                                ‚úÖ Zaakceptuj
                                            </button>
                                            <button
                                                onClick={() => setRejectModal(req)}
                                                className="px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-semibold"
                                            >
                                                ‚ùå Odrzuƒá
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Reject Modal */}
                    {rejectModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                                <h3 className="text-2xl font-bold mb-4">Odrzuƒá wniosek</h3>
                                <p className="text-gray-600 mb-4">Wniosek od: <strong>{rejectModal.employee.name}</strong></p>
                                <textarea
                                    value={comment}
                                    onChange={(e) => setComment(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 mb-4"
                                    rows="4"
                                    placeholder="Komentarz (opcjonalny)..."
                                ></textarea>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => {
                                            setRejectModal(null);
                                            setComment('');
                                        }}
                                        className="flex-1 px-4 py-3 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition font-semibold"
                                    >
                                        Anuluj
                                    </button>
                                    <button
                                        onClick={handleReject}
                                        className="flex-1 px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition font-semibold"
                                    >
                                        Odrzuƒá
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // USERS VIEW (Admin only)
        // ============================================
        const UsersView = ({ showToast }) => {
            const [users, setUsers] = useState([]);
            const [managers, setManagers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editModal, setEditModal] = useState(null);
            const [addModal, setAddModal] = useState(false);
            const [newUser, setNewUser] = useState({
                email: '',
                password: '',
                first_name: '',
                last_name: '',
                role: 'pracownik',
                supervisor_id: null
            });

            useEffect(() => {
                loadUsers();
                loadManagers();
            }, []);

            const loadUsers = async () => {
                try {
                    const res = await axios.get('/api/users');
                    setUsers(res.data);
                } catch (err) {
                    showToast('B≈ÇƒÖd wczytywania u≈ºytkownik√≥w', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const loadManagers = async () => {
                try {
                    const res = await axios.get('/api/users');
                    setManagers(res.data);
                } catch (err) {
                    console.error('Error loading managers:', err);
                }
            };

            const handleAddUser = async (e) => {
                e.preventDefault();
                try {
                    await axios.post('/api/users', newUser);
                    showToast('U≈ºytkownik dodany!', 'success');
                    setAddModal(false);
                    setNewUser({
                        email: '',
                        password: '',
                        first_name: '',
                        last_name: '',
                        role: 'pracownik',
                        supervisor_id: null
                    });
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd dodawania', 'error');
                }
            };

            const handleUpdateUser = async (e) => {
                e.preventDefault();
                try {
                    const updateData = {
                        first_name: editModal.first_name,
                        last_name: editModal.last_name,
                        role: editModal.role,
                        supervisor_id: editModal.supervisor_id
                    };
                    if (editModal.password) {
                        updateData.password = editModal.password;
                    }
                    await axios.put(`/api/users/${editModal.id}`, updateData);
                    showToast('U≈ºytkownik zaktualizowany!', 'success');
                    setEditModal(null);
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd aktualizacji', 'error');
                }
            };

            const handleDelete = async (userId) => {
                if (!confirm('Czy na pewno usunƒÖƒá tego u≈ºytkownika?')) return;

                try {
                    await axios.delete(`/api/users/${userId}`);
                    showToast('U≈ºytkownik usuniƒôty', 'success');
                    loadUsers();
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd usuwania', 'error');
                }
            };

            if (loading) return <LoadingSpinner />;

            const roleLabels = {
                'pracownik': 'Pracownik',
                'manager': 'Manager',
                'admin': 'Administrator'
            };

            return (
                <div className="p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-3xl font-bold">U≈ºytkownicy ({users.length})</h2>
                        <button
                            onClick={() => setAddModal(true)}
                            className="px-6 py-3 gradient-bg text-white rounded-xl font-semibold hover:opacity-90 transition"
                        >
                            ‚ûï Dodaj u≈ºytkownika
                        </button>
                    </div>

                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Imiƒô i nazwisko</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Email</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Rola</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Prze≈Ço≈ºony</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Akcje</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {users.map(user => (
                                    <tr key={user.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 font-semibold">{user.first_name} {user.last_name}</td>
                                        <td className="px-6 py-4 text-gray-600">{user.email}</td>
                                        <td className="px-6 py-4">
                                            <span className="px-3 py-1 rounded-full text-sm font-semibold bg-purple-100 text-purple-800">
                                                {roleLabels[user.role]}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-gray-600">
                                            {user.supervisor ? user.supervisor.name : '-'}
                                        </td>
                                        <td className="px-6 py-4">
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => setEditModal(user)}
                                                    className="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm"
                                                >
                                                    Edytuj
                                                </button>
                                                <button
                                                    onClick={() => handleDelete(user.id)}
                                                    className="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm"
                                                >
                                                    Usu≈Ñ
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Add User Modal */}
                    {addModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                                <h3 className="text-2xl font-bold mb-6">Dodaj u≈ºytkownika</h3>
                                <form onSubmit={handleAddUser} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Email *</label>
                                        <input
                                            type="email"
                                            required
                                            value={newUser.email}
                                            onChange={(e) => setNewUser({...newUser, email: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Has≈Ço * (min. 8 znak√≥w)</label>
                                        <input
                                            type="password"
                                            required
                                            minLength="8"
                                            value={newUser.password}
                                            onChange={(e) => setNewUser({...newUser, password: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Imiƒô *</label>
                                        <input
                                            type="text"
                                            required
                                            value={newUser.first_name}
                                            onChange={(e) => setNewUser({...newUser, first_name: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Nazwisko *</label>
                                        <input
                                            type="text"
                                            required
                                            value={newUser.last_name}
                                            onChange={(e) => setNewUser({...newUser, last_name: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Rola *</label>
                                        <select
                                            required
                                            value={newUser.role}
                                            onChange={(e) => setNewUser({...newUser, role: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        >
                                            <option value="pracownik">Pracownik</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Prze≈Ço≈ºony</label>
                                        <select
                                            value={newUser.supervisor_id || ''}
                                            onChange={(e) => setNewUser({...newUser, supervisor_id: e.target.value ? parseInt(e.target.value) : null})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        >
                                            <option value="">Brak prze≈Ço≈ºonego</option>
                                            {managers.map(m => (
                                                <option key={m.id} value={m.id}>{m.first_name} {m.last_name} ({m.role})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            type="submit"
                                            className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition font-semibold"
                                        >
                                            Dodaj
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setAddModal(false)}
                                            className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold"
                                        >
                                            Anuluj
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Edit User Modal */}
                    {editModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                                <h3 className="text-2xl font-bold mb-6">Edytuj u≈ºytkownika</h3>
                                <form onSubmit={handleUpdateUser} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Email</label>
                                        <input
                                            type="text"
                                            disabled
                                            value={editModal.email}
                                            className="w-full px-4 py-2 border rounded-lg bg-gray-100"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Nowe has≈Ço (pozostaw puste aby nie zmieniaƒá)</label>
                                        <input
                                            type="password"
                                            minLength="8"
                                            value={editModal.password || ''}
                                            onChange={(e) => setEditModal({...editModal, password: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Imiƒô *</label>
                                        <input
                                            type="text"
                                            required
                                            value={editModal.first_name}
                                            onChange={(e) => setEditModal({...editModal, first_name: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Nazwisko *</label>
                                        <input
                                            type="text"
                                            required
                                            value={editModal.last_name}
                                            onChange={(e) => setEditModal({...editModal, last_name: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Rola *</label>
                                        <select
                                            required
                                            value={editModal.role}
                                            onChange={(e) => setEditModal({...editModal, role: e.target.value})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        >
                                            <option value="pracownik">Pracownik</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">Prze≈Ço≈ºony</label>
                                        <select
                                            value={editModal.supervisor_id || ''}
                                            onChange={(e) => setEditModal({...editModal, supervisor_id: e.target.value ? parseInt(e.target.value) : null})}
                                            className="w-full px-4 py-2 border rounded-lg"
                                        >
                                            <option value="">Brak prze≈Ço≈ºonego</option>
                                            {managers.filter(m => m.id !== editModal.id).map(m => (
                                                <option key={m.id} value={m.id}>{m.first_name} {m.last_name} ({m.role})</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3 mt-6">
                                        <button
                                            type="submit"
                                            className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition font-semibold"
                                        >
                                            Zapisz
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setEditModal(null)}
                                            className="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold"
                                        >
                                            Anuluj
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // SETTINGS VIEW (Admin only)
        // ============================================
        const SettingsView = ({ showToast }) => {
            const [config, setConfig] = useState({
                server: '',
                port: 587,
                use_ssl: true,
                login: '',
                password: '',
                email_from: ''
            });
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                loadConfig();
            }, []);

            const loadConfig = async () => {
                try {
                    const res = await axios.get('/api/smtp-config');
                    setConfig(res.data);
                } catch (err) {
                    showToast('B≈ÇƒÖd wczytywania konfiguracji', 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleSave = async (e) => {
                e.preventDefault();
                setSaving(true);

                try {
                    await axios.post('/api/smtp-config', config);
                    showToast('Konfiguracja zapisana!', 'success');
                } catch (err) {
                    showToast(err.response?.data?.error || 'B≈ÇƒÖd zapisu', 'error');
                } finally {
                    setSaving(false);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-8 max-w-3xl mx-auto">
                    <h2 className="text-3xl font-bold mb-8">Ustawienia SMTP</h2>

                    <form onSubmit={handleSave} className="bg-white rounded-2xl shadow-lg p-8 space-y-6">
                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Server</label>
                            <input
                                type="text"
                                value={config.server || ''}
                                onChange={(e) => setConfig({...config, server: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="smtp.gmail.com"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700">Port</label>
                                <input
                                    type="number"
                                    value={config.port}
                                    onChange={(e) => setConfig({...config, port: parseInt(e.target.value)})}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-2 text-gray-700">Use SSL</label>
                                <select
                                    value={config.use_ssl.toString()}
                                    onChange={(e) => setConfig({...config, use_ssl: e.target.value === 'true'})}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                >
                                    <option value="true">Tak</option>
                                    <option value="false">Nie</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Login</label>
                            <input
                                type="text"
                                value={config.login || ''}
                                onChange={(e) => setConfig({...config, login: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="email@example.com"
                            />
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Password</label>
                            <input
                                type="password"
                                value={config.password || ''}
                                onChange={(e) => setConfig({...config, password: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            />
                        </div>

                        <div>
                            <label className="block font-semibold mb-2 text-gray-700">Email From</label>
                            <input
                                type="email"
                                value={config.email_from || ''}
                                onChange={(e) => setConfig({...config, email_from: e.target.value})}
                                className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="system@firma.pl"
                            />
                        </div>

                        <button
                            type="submit"
                            disabled={saving}
                            className="w-full px-6 py-3 gradient-bg text-white rounded-xl font-semibold hover:opacity-90 transition disabled:opacity-50 flex items-center justify-center gap-2"
                        >
                            {saving ? (
                                <>
                                    <div className="loading-spinner border-white"></div>
                                    <span>Zapisywanie...</span>
                                </>
                            ) : 'Zapisz konfiguracjƒô'}
                        </button>
                    </form>
                </div>
            );
        };

        // ============================================
        // AUDIT LOG VIEW (Admin only)
        // ============================================
        const AuditLogView = ({ showToast }) => {
            const [logs, setLogs] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadLogs();
            }, []);

            const loadLogs = async () => {
                try {
                    const res = await axios.get('/api/audit-logs?limit=50');
                    setLogs(res.data);
                } catch (err) {
                    showToast('B≈ÇƒÖd wczytywania log√≥w', 'error');
                } finally {
                    setLoading(false);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div className="p-8">
                    <h2 className="text-3xl font-bold mb-8">Audit Log ({logs.length})</h2>

                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Data</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">U≈ºytkownik</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Akcja</th>
                                    <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Szczeg√≥≈Çy</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {logs.map(log => (
                                    <tr key={log.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 text-sm text-gray-600">
                                            {new Date(log.timestamp).toLocaleString('pl-PL')}
                                        </td>
                                        <td className="px-6 py-4 font-semibold">{log.user}</td>
                                        <td className="px-6 py-4">
                                            <span className="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                                                {log.action}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-sm text-gray-600">{log.details || '-'}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // ============================================
        // MAIN APP
        // ============================================
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [toast, setToast] = useState(null);

            useEffect(() => {
                const token = localStorage.getItem('token');
                if (token) {
                    loadCurrentUser();
                }
            }, []);

            const loadCurrentUser = async () => {
                try {
                    const res = await axios.get('/api/me');
                    setUser(res.data);
                } catch (err) {
                    console.error('Failed to load user:', err);
                    localStorage.removeItem('token');
                    delete axios.defaults.headers.common['Authorization'];
                }
            };

            const showToast = (message, type = 'success') => {
                setToast({ message, type });
            };

            const handleLogout = () => {
                setUser(null);
                setView('dashboard');
            };

            if (!user) {
                return <LoginView onLogin={setUser} />;
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <Navbar user={user} onLogout={handleLogout} />
                    <div className="flex">
                        <Sidebar activeView={view} setView={setView} role={user.role} />
                        <div className="flex-1">
                            {view === 'dashboard' && <DashboardView user={user} />}
                            {view === 'new-request' && <NewRequestView user={user} showToast={showToast} setView={setView} />}
                            {view === 'my-requests' && <MyRequestsView user={user} showToast={showToast} />}
                            {view === 'pending' && <PendingRequestsView user={user} showToast={showToast} />}
                            {view === 'users' && <UsersView showToast={showToast} />}
                            {view === 'settings' && <SettingsView showToast={showToast} />}
                            {view === 'audit' && <AuditLogView showToast={showToast} />}
                        </div>
                    </div>

                    {toast && (
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}
                </div>
            );
        };

        // Render app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
